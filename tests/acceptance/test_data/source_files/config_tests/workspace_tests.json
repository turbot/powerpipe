[
  {
    "test": "env variables set, no command line arguments set and no workspace env variable set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": [
        "POWERPIPE_BENCHMARK_TIMEOUT=10m",
        "POWERPIPE_DASHBOARD_TIMEOUT=45s",
        "POWERPIPE_DATABASE=sqlite:/tmp/powerpipe.db",
        "POWERPIPE_LISTEN=local",
        "POWERPIPE_LOG_LEVEL=debug",
        "POWERPIPE_MAX_PARALLEL=8",
        "POWERPIPE_MEMORY_MAX_MB=16384",
        "PIPES_HOST=custom.pipes.example.com",
        "PIPES_TOKEN=tpt_test_token_123",
        "POWERPIPE_PORT=9042",
        "POWERPIPE_QUERY_TIMEOUT=300s",
        "POWERPIPE_SNAPSHOT_LOCATION=/tmp/powerpipe/snaps",
        "POWERPIPE_TELEMETRY=info",
        "POWERPIPE_UPDATE_CHECK=false"
      ],
      "args": []
    },
    "expected": {
      "benchmark-timeout": "10m",
      "dashboard-timeout": "45s",
      "database": "sqlite:/tmp/powerpipe.db",
      "listen": "local",
      "log-level": "debug",
      "max-parallel": 8,
      "memory-max-mb": 16384,
      "pipes-host": "custom.pipes.example.com",
      "pipes-token": "tpt_test_token_123",
      "port": 9042,
      "query-timeout": "300s",
      "snapshot-location": "/tmp/powerpipe/snaps",
      "telemetry": "info",
      "update-check": "false"
    }
  },
  {
    "test": "only --workspace command line argument set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": [],
      "args": ["--workspace=comprehensive_dev"]
    },
    "expected": {
      "workspace": "comprehensive_dev",
      "log-level": "info",
      "update-check": "true",
      "memory-max-mb": 1024,
      "benchmark-timeout": "5m",
      "dashboard-timeout": "30s",
      "database": "postgres://localhost:5432/powerpipe",
      "header": "off",
      "input": true,
      "listen": "local",
      "max-parallel": 10,
      "output": "table",
      "pipes-host": "pipes.turbot.com",
      "pipes-token": "tpt_c123456789abcdef",
      "port": 9033,
      "progress": true,
      "query-timeout": "300s",
      "search-path": ["aws", "azure", "gcp"],
      "search-path-prefix": "powerpipe",
      "separator": ",",
      "snapshot-location": "~/.powerpipe/snapshots",
      "telemetry": "info",
      "timing": false,
      "watch": true
    }
  },
  {
    "test": "all CLI arguments set except workspace arg and no env variables set",
    "description": "Validate all CLI flags map to expected config values",
    "cmd": "query",
    "setup": {
      "env": [],
      "args": [
        "--benchmark-timeout=12m",
        "--dashboard-timeout=50s",
        "--database=sqlite:/tmp/cli.db",
        "--header=false",
        "--input=false",
        "--listen=network",
        "--max-parallel=16",
        "--output=json",
        "--pipes-host=cli.pipes.example.com",
        "--pipes-token=tpt_cli_token_123",
        "--port=9050",
        "--progress=false",
        "--query-timeout=750s",
        "--search-path=aws,azure",
        "--separator=|",
        "--snapshot-location=/tmp/cli_snaps",
        "--timing=true",
        "--watch=true"
      ]
    },
    "expected": {
      "benchmark-timeout": "12m",
      "dashboard-timeout": "50s",
      "database": "sqlite:/tmp/cli.db",
      "header": false,
      "input": false,
      "listen": "network",
      "max-parallel": 16,
      "output": "json",
      "pipes-host": "cli.pipes.example.com",
      "pipes-token": "tpt_cli_token_123",
      "port": 9050,
      "progress": false,
      "query-timeout": "750s",
      "search-path": ["aws", "azure"],
      "separator": "|",
      "snapshot-location": "/tmp/cli_snaps",
      "timing": true,
      "watch": true
    }
  },
  {
    "test": "workspace env variable set and no command line arguments set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": ["POWERPIPE_WORKSPACE=production_ready"],
      "args": []
    },
    "expected": {
      "workspace": "production_ready",
      "benchmark-timeout": "15m",
      "dashboard-timeout": "60s",
      "database": "sqlite:./powerpipe.db",
      "header": "on",
      "input": false,
      "listen": "network",
      "log-level": "warn",
      "max-parallel": 20,
      "memory-max-mb": 2048,
      "output": "json",
      "pipes-host": "pipes.turbot.com",
      "pipes-token": "tpt_d987654321fedcba",
      "port": 9034,
      "progress": false,
      "query-timeout": "600s",
      "search-path": ["aws", "azure", "gcp", "kubernetes"],
      "search-path-prefix": "prod",
      "separator": "|",
      "snapshot-location": "/var/lib/powerpipe/snapshots",
      "telemetry": "none",
      "timing": true,
      "update-check": "false",
      "watch": false
    }
  },
  {
    "test": "All env variables set and command line argument set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": [
        "POWERPIPE_BENCHMARK_TIMEOUT=10m",
        "POWERPIPE_DASHBOARD_TIMEOUT=45s",
        "POWERPIPE_DATABASE=sqlite:/tmp/powerpipe.db",
        "POWERPIPE_LISTEN=local",
        "POWERPIPE_LOG_LEVEL=debug",
        "POWERPIPE_MAX_PARALLEL=8",
        "POWERPIPE_MEMORY_MAX_MB=16384",
        "PIPES_HOST=custom.pipes.example.com",
        "PIPES_TOKEN=tpt_test_token_123",
        "POWERPIPE_PORT=9042",
        "POWERPIPE_QUERY_TIMEOUT=300s",
        "POWERPIPE_SNAPSHOT_LOCATION=/tmp/powerpipe/snaps",
        "POWERPIPE_TELEMETRY=info",
        "POWERPIPE_UPDATE_CHECK=false"
      ],
      "args": [
        "--benchmark-timeout=12m",
        "--dashboard-timeout=50s",
        "--database=sqlite:/tmp/cli.db",
        "--header=false",
        "--input=false",
        "--listen=network",
        "--max-parallel=16",
        "--output=json",
        "--pipes-host=cli.pipes.example.com",
        "--pipes-token=tpt_cli_token_123",
        "--port=9050",
        "--progress=false",
        "--query-timeout=750s",
        "--search-path=aws,azure",
        "--separator=|",
        "--snapshot-location=/tmp/cli_snaps",
        "--timing=true",
        "--watch=true"
      ]
    },
    "expected": {
      "benchmark-timeout": "12m",
      "dashboard-timeout": "50s",
      "database": "sqlite:/tmp/cli.db",
      "header": false,
      "input": false,
      "listen": "network",
      "max-parallel": 16,
      "output": "json",
      "pipes-host": "cli.pipes.example.com",
      "pipes-token": "tpt_cli_token_123",
      "port": 9050,
      "progress": false,
      "query-timeout": "750s",
      "search-path": ["aws", "azure"],
      "separator": "|",
      "snapshot-location": "/tmp/cli_snaps",
      "timing": true,
      "watch": true
    }
  },
  {
    "test": "workspace env variable set and --workspace arg passed",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": ["POWERPIPE_WORKSPACE=production_ready"],
      "args": [
        "--workspace=comprehensive_dev"
      ]
    },
    "expected": {
      "workspace": "comprehensive_dev",
      "log-level": "info",
      "update-check": "true",
      "memory-max-mb": 1024,
      "benchmark-timeout": "5m",
      "dashboard-timeout": "30s",
      "database": "postgres://localhost:5432/powerpipe",
      "header": "off",
      "input": true,
      "listen": "local",
      "max-parallel": 10,
      "output": "table",
      "pipes-host": "pipes.turbot.com",
      "pipes-token": "tpt_c123456789abcdef",
      "port": 9033,
      "progress": true,
      "query-timeout": "300s",
      "search-path": ["aws", "azure", "gcp"],
      "search-path-prefix": "powerpipe",
      "separator": ",",
      "snapshot-location": "~/.powerpipe/snapshots",
      "telemetry": "info",
      "timing": false,
      "watch": true
    }
  },
  {
    "test": "all env variables set including workspace env variable and no command line arguments set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": [
        "POWERPIPE_WORKSPACE=production_ready",
        "POWERPIPE_BENCHMARK_TIMEOUT=10m",
        "POWERPIPE_DASHBOARD_TIMEOUT=45s",
        "POWERPIPE_DATABASE=sqlite:/tmp/powerpipe.db",
        "POWERPIPE_LISTEN=local",
        "POWERPIPE_LOG_LEVEL=debug",
        "POWERPIPE_MAX_PARALLEL=8",
        "POWERPIPE_MEMORY_MAX_MB=16384",
        "PIPES_HOST=custom.pipes.example.com",
        "PIPES_TOKEN=tpt_test_token_123",
        "POWERPIPE_PORT=9042",
        "POWERPIPE_QUERY_TIMEOUT=300s",
        "POWERPIPE_SNAPSHOT_LOCATION=/tmp/powerpipe/snaps",
        "POWERPIPE_TELEMETRY=info",
        "POWERPIPE_UPDATE_CHECK=false"
      ],
      "args": []
    },
    "expected": {
      "workspace": "production_ready",
      "benchmark-timeout": "15m",
      "dashboard-timeout": "60s",
      "database": "sqlite:./powerpipe.db",
      "header": "on",
      "input": false,
      "listen": "network",
      "log-level": "warn",
      "max-parallel": 20,
      "memory-max-mb": 2048,
      "output": "json",
      "pipes-host": "pipes.turbot.com",
      "pipes-token": "tpt_d987654321fedcba",
      "port": 9034,
      "progress": false,
      "query-timeout": "600s",
      "search-path": ["aws", "azure", "gcp", "kubernetes"],
      "search-path-prefix": "prod",
      "separator": "|",
      "snapshot-location": "/var/lib/powerpipe/snapshots",
      "telemetry": "none",
      "timing": true,
      "update-check": "false",
      "watch": false
    }
  },
  {
    "test": "all cli arguments with workspace arg and no env variables set",
    "description": "",
    "cmd": "query",
    "setup": {
      "env": [
      ],
      "args": [
        "--workspace=production_ready",
        "--benchmark-timeout=12m",
        "--dashboard-timeout=50s",
        "--database=sqlite:/tmp/cli.db",
        "--header=false",
        "--input=false",
        "--listen=network",
        "--max-parallel=16",
        "--output=json",
        "--pipes-host=cli.pipes.example.com",
        "--pipes-token=tpt_cli_token_123",
        "--port=9050",
        "--progress=false",
        "--query-timeout=750s",
        "--search-path=aws,azure",
        "--separator=|",
        "--snapshot-location=/tmp/cli_snaps",
        "--timing=true",
        "--watch=true"
      ]
    },
    "expected": {
      "workspace": "production_ready",
      "benchmark-timeout": "15m",
      "dashboard-timeout": "60s",
      "database": "sqlite:./powerpipe.db",
      "header": "on",
      "input": false,
      "listen": "network",
      "log-level": "warn",
      "max-parallel": 20,
      "memory-max-mb": 2048,
      "output": "json",
      "pipes-host": "pipes.turbot.com",
      "pipes-token": "tpt_d987654321fedcba",
      "port": 9034,
      "progress": false,
      "query-timeout": "600s",
      "search-path": ["aws", "azure", "gcp", "kubernetes"],
      "search-path-prefix": "prod",
      "separator": "|",
      "snapshot-location": "/var/lib/powerpipe/snapshots",
      "telemetry": "none",
      "timing": true,
      "update-check": "false",
      "watch": false
    }
  }
]
